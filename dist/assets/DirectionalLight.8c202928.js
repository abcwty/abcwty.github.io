var p=Object.defineProperty;var D=(a,e,t)=>e in a?p(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e,t)=>(D(a,typeof e!="symbol"?e+"":e,t),t);import{cA as C,cB as R,cC as B,cy as h,cs as r,cD as P,cE as S,cF as b,cz as v,cG as d,cH as E,cn as j}from"./index.66975801.js";import{L as x}from"./LightBase.dae87e70.js";class g extends x{constructor(){super(B);o(this,"defaultShadowResolution",1024);o(this,"shadowDistanceState",new j(void 0));this.createEffect(()=>{const t=this.lightState.get();if(!!t)return h.add(t.target),h.attach(t),()=>{h.remove(t.target),h.remove(t)}},[this.lightState.get]),this.createEffect(()=>{var w,f;const t=this.lightState.get();if(!t)return;const s=r().userData.manager,c=s?Math.max(P.mapRange(s.innerZ*(s.fov/75)*(1/s.zoom),500,1e3,1,1.5),1):1,n=(f=(w=this.shadowDistanceState.get())!=null?w:S())!=null?f:b,i=t.shadow.camera;i.zoom=500/c/n,i.updateProjectionMatrix();const u=this.shadowBiasComputedState.get(),l=this.shadowResolutionComputedState.get();if(!u||!l)return;const m=u;return t.shadow.bias=m*c*(this.defaultShadowResolution/l)*.5,()=>{t.shadow.bias=m}},[this.lightState.get,this.shadowDistanceState.get,S,r,this.shadowBiasComputedState.get,this.shadowResolutionComputedState.get]),this.createEffect(()=>{const t=this.lightState.get();if(!t)return;const s=r(),c=v(()=>{const n=d(s),i=d(this.outerObject3d);t.position.copy(n).add(i),t.target.position.copy(n).sub(i)});return()=>{c.cancel()}},[r,this.lightState.get])}getWorldPosition(){return E(d(this.outerObject3d))}get shadowDistance(){return this.shadowDistanceState.get()}set shadowDistance(t){this.shadowDistanceState.set(t)}}o(g,"componentName","directionalLight"),o(g,"defaults",C),o(g,"schema",R);export{g as default};
