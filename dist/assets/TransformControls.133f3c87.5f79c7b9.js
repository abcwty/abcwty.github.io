import{a5 as xt,H as r,h as it,a6 as g,O as mt,d as wt,V as _t,a7 as w,a8 as d,A as ot,a9 as st,a as n,aa as V,_ as E,ab as ft,ac as H,ad as Et,l as It,ae as Xt}from"./index.66975801.js";const Z=new xt,u=new r,I=new r,l=new g,at={X:new r(1,0,0),Y:new r(0,1,0),Z:new r(0,0,1)},tt={type:"change"},rt={type:"mouseDown"},ht={type:"mouseUp",mode:null},lt={type:"objectChange"};class Ct extends it{constructor(o,e){super(),e===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),e=document),this.isTransformControls=!0,this.visible=!1,this.domElement=e,this.domElement.style.touchAction="none";const s=new Tt;this._gizmo=s,this.add(s);const i=new jt;this._plane=i,this.add(i);const t=this;function a(y,X){let j=X;Object.defineProperty(t,y,{get:function(){return j!==void 0?j:X},set:function(Q){j!==Q&&(j=Q,i[y]=Q,s[y]=Q,t.dispatchEvent({type:y+"-changed",value:Q}),t.dispatchEvent(tt))}}),t[y]=X,i[y]=X,s[y]=X}a("camera",o),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const p=new r,A=new r,z=new g,T=new g,C=new r,k=new g,O=new r,S=new r,x=new r,M=0,_=new r;a("worldPosition",p),a("worldPositionStart",A),a("worldQuaternion",z),a("worldQuaternionStart",T),a("cameraPosition",C),a("cameraQuaternion",k),a("pointStart",O),a("pointEnd",S),a("rotationAxis",x),a("rotationAngle",M),a("eye",_),this._offset=new r,this._startNorm=new r,this._endNorm=new r,this._cameraScale=new r,this._parentPosition=new r,this._parentQuaternion=new g,this._parentQuaternionInv=new g,this._parentScale=new r,this._worldScaleStart=new r,this._worldQuaternionInv=new g,this._worldScale=new r,this._positionStart=new r,this._quaternionStart=new g,this._scaleStart=new r,this._getPointer=Qt.bind(this),this._onPointerDown=Yt.bind(this),this._onPointerHover=Zt.bind(this),this._onPointerMove=At.bind(this),this._onPointerUp=zt.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(o){if(this.object===void 0||this.dragging===!0)return;Z.setFromCamera(o,this.camera);const e=et(this._gizmo.picker[this.mode],Z);e?this.axis=e.object.name:this.axis=null}pointerDown(o){if(!(this.object===void 0||this.dragging===!0||o.button!==0)&&this.axis!==null){Z.setFromCamera(o,this.camera);const e=et(this._plane,Z,!0);e&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(e.point).sub(this.worldPositionStart)),this.dragging=!0,rt.mode=this.mode,this.dispatchEvent(rt)}}pointerMove(o){const e=this.axis,s=this.mode,i=this.object;let t=this.space;if(s==="scale"?t="local":(e==="E"||e==="XYZE"||e==="XYZ")&&(t="world"),i===void 0||e===null||this.dragging===!1||o.button!==-1)return;Z.setFromCamera(o,this.camera);const a=et(this._plane,Z,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),s==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),t==="local"&&e!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),e.indexOf("X")===-1&&(this._offset.x=0),e.indexOf("Y")===-1&&(this._offset.y=0),e.indexOf("Z")===-1&&(this._offset.z=0),t==="local"&&e!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(t==="local"&&(i.position.applyQuaternion(l.copy(this._quaternionStart).invert()),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),t==="world"&&(i.parent&&i.position.add(u.setFromMatrixPosition(i.parent.matrixWorld)),e.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),e.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),e.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(u.setFromMatrixPosition(i.parent.matrixWorld))));else if(s==="scale"){if(e.search("XYZ")!==-1){let p=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(p*=-1),I.set(p,p,p)}else u.copy(this.pointStart),I.copy(this.pointEnd),u.applyQuaternion(this._worldQuaternionInv),I.applyQuaternion(this._worldQuaternionInv),I.divide(u),e.search("X")===-1&&(I.x=1),e.search("Y")===-1&&(I.y=1),e.search("Z")===-1&&(I.z=1);i.scale.copy(this._scaleStart).multiply(I),this.scaleSnap&&(e.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),e.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(s==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const p=20/this.worldPosition.distanceTo(u.setFromMatrixPosition(this.camera.matrixWorld));e==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):e==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(u.copy(this.rotationAxis).cross(this.eye))*p):(e==="X"||e==="Y"||e==="Z")&&(this.rotationAxis.copy(at[e]),u.copy(at[e]),t==="local"&&u.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(u.cross(this.eye).normalize())*p),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),t==="local"&&e!=="E"&&e!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(l.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(l.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(tt),this.dispatchEvent(lt)}}pointerUp(o){o.button===0&&(this.dragging&&this.axis!==null&&(ht.mode=this.mode,this.dispatchEvent(ht)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(o){o.geometry&&o.geometry.dispose(),o.material&&o.material.dispose()})}attach(o){return this.object=o,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){!this.enabled||this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(tt),this.dispatchEvent(lt),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Z}getMode(){return this.mode}setMode(o){this.mode=o}setTranslationSnap(o){this.translationSnap=o}setRotationSnap(o){this.rotationSnap=o}setScaleSnap(o){this.scaleSnap=o}setSize(o){this.size=o}setSpace(o){this.space=o}}function Qt(c){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:c.button};{const o=this.domElement.getBoundingClientRect();return{x:(c.clientX-o.left)/o.width*2-1,y:-(c.clientY-o.top)/o.height*2+1,button:c.button}}}function Zt(c){if(this.enabled)switch(c.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(c));break}}function Yt(c){!this.enabled||(document.pointerLockElement||this.domElement.setPointerCapture(c.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(c)),this.pointerDown(this._getPointer(c)))}function At(c){!this.enabled||this.pointerMove(this._getPointer(c))}function zt(c){!this.enabled||(this.domElement.releasePointerCapture(c.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(c)))}function et(c,o,e){const s=o.intersectObject(c,!0);for(let i=0;i<s.length;i++)if(s[i].object.visible||e)return s[i];return!1}const B=new Xt,h=new r(0,1,0),ct=new r(0,0,0),pt=new mt,$=new g,K=new g,P=new r,dt=new mt,D=new r(1,0,0),Y=new r(0,1,0),L=new r(0,0,1),J=new r,W=new r,F=new r;class Tt extends it{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const o=new wt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),e=new _t({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),s=o.clone();s.opacity=.15;const i=e.clone();i.opacity=.5;const t=o.clone();t.color.setHex(16711680);const a=o.clone();a.color.setHex(65280);const p=o.clone();p.color.setHex(255);const A=o.clone();A.color.setHex(16711680),A.opacity=.5;const z=o.clone();z.color.setHex(65280),z.opacity=.5;const T=o.clone();T.color.setHex(255),T.opacity=.5;const C=o.clone();C.opacity=.25;const k=o.clone();k.color.setHex(16776960),k.opacity=.25,o.clone().color.setHex(16776960);const O=o.clone();O.color.setHex(7895160);const S=new w(0,.04,.1,12);S.translate(0,.05,0);const x=new d(.08,.08,.08);x.translate(0,.04,0);const M=new ot;M.setAttribute("position",new st([0,0,0,1,0,0],3));const _=new w(.0075,.0075,.5,3);_.translate(0,.25,0);function y(b,R){const v=new H(b,.0075,3,64,R*Math.PI*2);return v.rotateY(Math.PI/2),v.rotateX(Math.PI/2),v}function X(){const b=new ot;return b.setAttribute("position",new st([0,0,0,1,1,1],3)),b}const j={X:[[new n(S,t),[.5,0,0],[0,0,-Math.PI/2]],[new n(S,t),[-.5,0,0],[0,0,Math.PI/2]],[new n(_,t),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n(S,a),[0,.5,0]],[new n(S,a),[0,-.5,0],[Math.PI,0,0]],[new n(_,a)]],Z:[[new n(S,p),[0,0,.5],[Math.PI/2,0,0]],[new n(S,p),[0,0,-.5],[-Math.PI/2,0,0]],[new n(_,p),null,[Math.PI/2,0,0]]],XYZ:[[new n(new V(.1,0),C.clone()),[0,0,0]]],XY:[[new n(new d(.15,.15,.01),T.clone()),[.15,.15,0]]],YZ:[[new n(new d(.15,.15,.01),A.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new d(.15,.15,.01),z.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},Q={X:[[new n(new w(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new n(new w(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new w(.2,0,.6,4),s),[0,.3,0]],[new n(new w(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new w(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new n(new w(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n(new V(.2,0),s)]],XY:[[new n(new d(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new n(new d(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new d(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]]},ut={START:[[new n(new V(.01,2),i),null,null,null,"helper"]],END:[[new n(new V(.01,2),i),null,null,null,"helper"]],DELTA:[[new E(X(),i),null,null,null,"helper"]],X:[[new E(M,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new E(M,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new E(M,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},yt={XYZE:[[new n(y(.5,1),O),null,[0,Math.PI/2,0]]],X:[[new n(y(.5,.5),t)]],Y:[[new n(y(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new n(y(.5,.5),p),null,[0,Math.PI/2,0]]],E:[[new n(y(.75,1),k),null,[0,Math.PI/2,0]]]},bt={AXIS:[[new E(M,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},vt={XYZE:[[new n(new ft(.25,10,8),s)]],X:[[new n(new H(.5,.1,4,24),s),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n(new H(.5,.1,4,24),s),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n(new H(.5,.1,4,24),s),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n(new H(.75,.1,2,24),s)]]},Mt={X:[[new n(x,t),[.5,0,0],[0,0,-Math.PI/2]],[new n(_,t),[0,0,0],[0,0,-Math.PI/2]],[new n(x,t),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n(x,a),[0,.5,0]],[new n(_,a)],[new n(x,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n(x,p),[0,0,.5],[Math.PI/2,0,0]],[new n(_,p),[0,0,0],[Math.PI/2,0,0]],[new n(x,p),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n(new d(.15,.15,.01),T),[.15,.15,0]]],YZ:[[new n(new d(.15,.15,.01),A),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new d(.15,.15,.01),z),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new d(.1,.1,.1),C.clone())]]},Pt={X:[[new n(new w(.2,0,.6,4),s),[.3,0,0],[0,0,-Math.PI/2]],[new n(new w(.2,0,.6,4),s),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n(new w(.2,0,.6,4),s),[0,.3,0]],[new n(new w(.2,0,.6,4),s),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n(new w(.2,0,.6,4),s),[0,0,.3],[Math.PI/2,0,0]],[new n(new w(.2,0,.6,4),s),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n(new d(.2,.2,.01),s),[.15,.15,0]]],YZ:[[new n(new d(.2,.2,.01),s),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n(new d(.2,.2,.01),s),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n(new d(.2,.2,.2),s),[0,0,0]]]},gt={X:[[new E(M,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new E(M,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new E(M,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function f(b){const R=new it;for(const v in b)for(let q=b[v].length;q--;){const m=b[v][q][0].clone(),N=b[v][q][1],U=b[v][q][2],G=b[v][q][3],St=b[v][q][4];m.name=v,m.tag=St,N&&m.position.set(N[0],N[1],N[2]),U&&m.rotation.set(U[0],U[1],U[2]),G&&m.scale.set(G[0],G[1],G[2]),m.updateMatrix();const nt=m.geometry.clone();nt.applyMatrix4(m.matrix),m.geometry=nt,m.renderOrder=1/0,m.position.set(0,0,0),m.rotation.set(0,0,0),m.scale.set(1,1,1),R.add(m)}return R}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=f(j)),this.add(this.gizmo.rotate=f(yt)),this.add(this.gizmo.scale=f(Mt)),this.add(this.picker.translate=f(Q)),this.add(this.picker.rotate=f(vt)),this.add(this.picker.scale=f(Pt)),this.add(this.helper.translate=f(ut)),this.add(this.helper.rotate=f(bt)),this.add(this.helper.scale=f(gt)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(o){const e=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:K;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let s=[];s=s.concat(this.picker[this.mode].children),s=s.concat(this.gizmo[this.mode].children),s=s.concat(this.helper[this.mode].children);for(let i=0;i<s.length;i++){const t=s[i];t.visible=!0,t.rotation.set(0,0,0),t.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),t.scale.set(1,1,1).multiplyScalar(a*this.size/4),t.tag==="helper"){t.visible=!1,t.name==="AXIS"?(t.position.copy(this.worldPositionStart),t.visible=!!this.axis,this.axis==="X"&&(l.setFromEuler(B.set(0,0,0)),t.quaternion.copy(e).multiply(l),Math.abs(h.copy(D).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Y"&&(l.setFromEuler(B.set(0,0,Math.PI/2)),t.quaternion.copy(e).multiply(l),Math.abs(h.copy(Y).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="Z"&&(l.setFromEuler(B.set(0,Math.PI/2,0)),t.quaternion.copy(e).multiply(l),Math.abs(h.copy(L).applyQuaternion(e).dot(this.eye))>.9&&(t.visible=!1)),this.axis==="XYZE"&&(l.setFromEuler(B.set(0,Math.PI/2,0)),h.copy(this.rotationAxis),t.quaternion.setFromRotationMatrix(pt.lookAt(ct,h,Y)),t.quaternion.multiply(l),t.visible=this.dragging),this.axis==="E"&&(t.visible=!1)):t.name==="START"?(t.position.copy(this.worldPositionStart),t.visible=this.dragging):t.name==="END"?(t.position.copy(this.worldPosition),t.visible=this.dragging):t.name==="DELTA"?(t.position.copy(this.worldPositionStart),t.quaternion.copy(this.worldQuaternionStart),u.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),u.applyQuaternion(this.worldQuaternionStart.clone().invert()),t.scale.copy(u),t.visible=this.dragging):(t.quaternion.copy(e),this.dragging?t.position.copy(this.worldPositionStart):t.position.copy(this.worldPosition),this.axis&&(t.visible=this.axis.search(t.name)!==-1));continue}t.quaternion.copy(e),this.mode==="translate"||this.mode==="scale"?(t.name==="X"&&Math.abs(h.copy(D).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Y"&&Math.abs(h.copy(Y).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="Z"&&Math.abs(h.copy(L).applyQuaternion(e).dot(this.eye))>.99&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XY"&&Math.abs(h.copy(L).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="YZ"&&Math.abs(h.copy(D).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1),t.name==="XZ"&&Math.abs(h.copy(Y).applyQuaternion(e).dot(this.eye))<.2&&(t.scale.set(1e-10,1e-10,1e-10),t.visible=!1)):this.mode==="rotate"&&($.copy(e),h.copy(this.eye).applyQuaternion(l.copy(e).invert()),t.name.search("E")!==-1&&t.quaternion.setFromRotationMatrix(pt.lookAt(this.eye,ct,Y)),t.name==="X"&&(l.setFromAxisAngle(D,Math.atan2(-h.y,h.z)),l.multiplyQuaternions($,l),t.quaternion.copy(l)),t.name==="Y"&&(l.setFromAxisAngle(Y,Math.atan2(h.x,h.z)),l.multiplyQuaternions($,l),t.quaternion.copy(l)),t.name==="Z"&&(l.setFromAxisAngle(L,Math.atan2(h.y,h.x)),l.multiplyQuaternions($,l),t.quaternion.copy(l))),t.visible=t.visible&&(t.name.indexOf("X")===-1||this.showX),t.visible=t.visible&&(t.name.indexOf("Y")===-1||this.showY),t.visible=t.visible&&(t.name.indexOf("Z")===-1||this.showZ),t.visible=t.visible&&(t.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),t.material._color=t.material._color||t.material.color.clone(),t.material._opacity=t.material._opacity||t.material.opacity,t.material.color.copy(t.material._color),t.material.opacity=t.material._opacity,this.enabled&&this.axis&&(t.name===this.axis||this.axis.split("").some(function(p){return t.name===p}))&&(t.material.color.setHex(16776960),t.material.opacity=1)}super.updateMatrixWorld(o)}}class jt extends n{constructor(){super(new Et(1e5,1e5,2,2),new wt({visible:!1,wireframe:!0,side:It,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(o){let e=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(e="local"),J.copy(D).applyQuaternion(e==="local"?this.worldQuaternion:K),W.copy(Y).applyQuaternion(e==="local"?this.worldQuaternion:K),F.copy(L).applyQuaternion(e==="local"?this.worldQuaternion:K),h.copy(W),this.mode){case"translate":case"scale":switch(this.axis){case"X":h.copy(this.eye).cross(J),P.copy(J).cross(h);break;case"Y":h.copy(this.eye).cross(W),P.copy(W).cross(h);break;case"Z":h.copy(this.eye).cross(F),P.copy(F).cross(h);break;case"XY":P.copy(F);break;case"YZ":P.copy(J);break;case"XZ":h.copy(F),P.copy(W);break;case"XYZ":case"E":P.set(0,0,0);break}break;case"rotate":default:P.set(0,0,0)}P.length()===0?this.quaternion.copy(this.cameraQuaternion):(dt.lookAt(u.set(0,0,0),P,h),this.quaternion.setFromRotationMatrix(dt)),super.updateMatrixWorld(o)}}export{Ct as TransformControls,Tt as TransformControlsGizmo,jt as TransformControlsPlane};
