import{a as I,ad as H,bc as M,d as P,bd as A,be as X,bf as _,aR as N,ap as z}from"./index.66975801.js";class V extends I{constructor(c){const a=new F(c),f=new H(a.image.width*M,a.image.height*M),h=new P({map:a,toneMapped:!1,transparent:!0});super(f,h);function d(w){h.map.dispatchDOMEvent(w)}this.addEventListener("mousedown",d),this.addEventListener("mousemove",d),this.addEventListener("mouseup",d),this.addEventListener("click",d),this.dispose=function(){f.dispose(),h.dispose(),h.map.dispose(),this.removeEventListener("mousedown",d),this.removeEventListener("mousemove",d),this.removeEventListener("mouseup",d),this.removeEventListener("click",d)},this.update=()=>a.update()}}class Y extends A{constructor(c){const a=new F(c),f=new X({map:a,toneMapped:!1,transparent:!0});super(f),this.scale.set(a.image.width*M,a.image.height*M,0);function h(d){f.map.dispatchDOMEvent(d)}this.addEventListener("mousedown",h),this.addEventListener("mousemove",h),this.addEventListener("mouseup",h),this.addEventListener("click",h),this.dispose=function(){f.dispose(),f.map.dispose(),this.removeEventListener("mousedown",h),this.removeEventListener("mousemove",h),this.removeEventListener("mouseup",h),this.removeEventListener("click",h)},this.update=()=>a.update()}}class F extends _{constructor(c){super(D(c)),this.dom=c,this.anisotropy=16,this.minFilter=N,this.magFilter=N;const a=new MutationObserver(()=>{this.update()}),f={attributes:!0,childList:!0,subtree:!0,characterData:!0};a.observe(c,f),this.observer=a}dispatchDOMEvent(c){c.data&&j(this.dom,c.type,c.data.x,c.data.y)}update(){this.image=D(this.dom),this.needsUpdate=!0}dispose(){this.observer&&this.observer.disconnect(),super.dispose()}}const R=new WeakMap;function D(m){const c=document.createRange(),a=new z;function f(e){const n=[];let i=!1;function o(){if(i&&(i=!1,e.restore()),n.length===0)return;let s=-1/0,r=-1/0,y=1/0,l=1/0;for(let b=0;b<n.length;b++){const E=n[b];s=Math.max(s,E.x),r=Math.max(r,E.y),y=Math.min(y,E.x+E.width),l=Math.min(l,E.y+E.height)}e.save(),e.beginPath(),e.rect(s,r,y-s,l-r),e.clip(),i=!0}return{add:function(s){n.push(s),o()},remove:function(){n.pop(),o()}}}function h(e,n,i,o){o!==""&&(e.textTransform==="uppercase"&&(o=o.toUpperCase()),t.font=e.fontWeight+" "+e.fontSize+" "+e.fontFamily,t.textBaseline="top",t.fillStyle=e.color,t.fillText(o,n,i+parseFloat(e.fontSize)*.1))}function d(e,n,i,o,s){i<2*s&&(s=i/2),o<2*s&&(s=o/2),t.beginPath(),t.moveTo(e+s,n),t.arcTo(e+i,n,e+i,n+o,s),t.arcTo(e+i,n+o,e,n+o,s),t.arcTo(e,n+o,e,n,s),t.arcTo(e,n,e+i,n,s),t.closePath()}function w(e,n,i,o,s,r){const y=e[n+"Width"],l=e[n+"Style"],b=e[n+"Color"];y!=="0px"&&l!=="none"&&b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(t.strokeStyle=b,t.lineWidth=parseFloat(y),t.beginPath(),t.moveTo(i,o),t.lineTo(i+s,o+r),t.stroke())}function u(e,n){let i=0,o=0,s=0,r=0;if(e.nodeType===Node.TEXT_NODE){c.selectNode(e);const l=c.getBoundingClientRect();i=l.left-g.left-.5,o=l.top-g.top-.5,s=l.width,r=l.height,h(n,i,o,e.nodeValue.trim())}else{if(e.nodeType===Node.COMMENT_NODE)return;if(e instanceof HTMLCanvasElement){if(e.style.display==="none")return;t.save();const l=window.devicePixelRatio;t.scale(1/l,1/l),t.drawImage(e,0,0),t.restore()}else{if(e.style.display==="none")return;const l=e.getBoundingClientRect();i=l.left-g.left-.5,o=l.top-g.top-.5,s=l.width,r=l.height,n=window.getComputedStyle(e),d(i,o,s,r,parseFloat(n.borderRadius));const b=n.backgroundColor;b!=="transparent"&&b!=="rgba(0, 0, 0, 0)"&&(t.fillStyle=b,t.fill());const E=["borderTop","borderLeft","borderBottom","borderRight"];let S=!0,x=null;for(const p of E){if(x!==null&&(S=n[p+"Width"]===n[x+"Width"]&&n[p+"Color"]===n[x+"Color"]&&n[p+"Style"]===n[x+"Style"]),S===!1)break;x=p}if(S===!0){const p=parseFloat(n.borderTopWidth);n.borderTopWidth!=="0px"&&n.borderTopStyle!=="none"&&n.borderTopColor!=="transparent"&&n.borderTopColor!=="rgba(0, 0, 0, 0)"&&(t.strokeStyle=n.borderTopColor,t.lineWidth=p,t.stroke())}else w(n,"borderTop",i,o,s,0),w(n,"borderLeft",i,o,0,r),w(n,"borderBottom",i,o+r,s,0),w(n,"borderRight",i+s,o,0,r);if(e instanceof HTMLInputElement){let p=n.accentColor;(p===void 0||p==="auto")&&(p=n.color),a.set(p);const k=Math.sqrt(.299*a.r**2+.587*a.g**2+.114*a.b**2)<.5?"white":"#111111";if(e.type==="radio"&&(d(i,o,s,r,r),t.fillStyle="white",t.strokeStyle=p,t.lineWidth=1,t.fill(),t.stroke(),e.checked&&(d(i+2,o+2,s-4,r-4,r),t.fillStyle=p,t.strokeStyle=k,t.lineWidth=2,t.fill(),t.stroke())),e.type==="checkbox"&&(d(i,o,s,r,2),t.fillStyle=e.checked?p:"white",t.strokeStyle=e.checked?k:p,t.lineWidth=1,t.stroke(),t.fill(),e.checked)){const L=t.textAlign;t.textAlign="center";const C={color:k,fontFamily:n.fontFamily,fontSize:r+"px",fontWeight:"bold"};h(C,i+s/2,o,"\u2714"),t.textAlign=L}if(e.type==="range"){const[L,C,B]=["min","max","value"].map(O=>parseFloat(e[O])),W=(B-L)/(C-L)*(s-r);d(i,o+r/4,s,r/2,r/4),t.fillStyle=k,t.strokeStyle=p,t.lineWidth=1,t.fill(),t.stroke(),d(i,o+r/4,W+r/2,r/2,r/4),t.fillStyle=p,t.fill(),d(i+W,o,r,r,r/2),t.fillStyle=p,t.fill()}(e.type==="color"||e.type==="text"||e.type==="number")&&(T.add({x:i,y:o,width:s,height:r}),h(n,i+parseInt(n.paddingLeft),o+parseInt(n.paddingTop),e.value),T.remove())}}}const y=n.overflow==="auto"||n.overflow==="hidden";y&&T.add({x:i,y:o,width:s,height:r});for(let l=0;l<e.childNodes.length;l++)u(e.childNodes[l],n);y&&T.remove()}const g=m.getBoundingClientRect();let v;R.has(m)?v=R.get(m):(v=document.createElement("canvas"),v.width=g.width,v.height=g.height);const t=v.getContext("2d"),T=new f(t);return u(m),v}function j(m,c,a,f){const h={clientX:a*m.offsetWidth+m.offsetLeft,clientY:f*m.offsetHeight+m.offsetTop,view:m.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(c,h));const d=m.getBoundingClientRect();a=a*d.width+d.left,f=f*d.height+d.top;function w(u){if(u.nodeType!==Node.TEXT_NODE&&u.nodeType!==Node.COMMENT_NODE){const g=u.getBoundingClientRect();if(a>g.left&&a<g.right&&f>g.top&&f<g.bottom&&(u.dispatchEvent(new MouseEvent(c,h)),u instanceof HTMLInputElement&&u.type==="range"&&(c==="mousedown"||c==="click"))){const[v,t]=["min","max"].map(n=>parseFloat(u[n])),T=g.width,e=(a-g.x)/T;u.value=v+(t-v)*e,u.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let v=0;v<u.childNodes.length;v++)w(u.childNodes[v])}}w(m)}export{V as HTMLMesh,Y as HTMLSprite};
